(function(){"use strict";function x(t){const n=Math.max(1e-4,t.dt||.001),l=Math.max(n,t.duration||5),c=Math.floor(l/n),u=t.rho_disc,M=t.cp_disc,I=t.k_disc,i=t.R,_=t.thickness,F=Math.PI*i*i*_*u,f=I/(u*M),m=t.distance*t.distance,B=t.T0||20,P=new Float64Array(c);for(let e=0;e<c;e++){const s=e*n;if(s>0){const o=Math.pow(4*Math.PI*f*s,1.5),r=Math.exp(-m/(4*f*s));P[e]=1/(F*M)*r/o}}const h=new Float64Array(c),d=new Float64Array(c);let a=t.scenario==="Acceleration with Brake"?0:t.wheelFrequency||10;const T=t.FN,q=t.mu,w=t.aNeg||-2,N=t.aPos||1,R=2*Math.PI,g=t.nBK,S=2*Math.PI;let y=0;const k=t.bkAngles.slice();for(let e=0;e<c;e++){const s=a*(2*Math.PI*i);if(t.scenario==="Emergency Brake")a=Math.max(s+w*n,0)/(2*Math.PI*i);else if(t.scenario==="Acceleration with Brake"){const o=N+w;a=Math.max(s+o*n,0)/(2*Math.PI*i)}else t.scenario;d[e]=a*(2*Math.PI*i),y+=a*R*n;for(let o=0;o<g;o++)if(y>=k[o]){const b=q*T*i*(Math.PI/g);h[e]+=b,k[o]+=S}}const v=new Float64Array(c);for(let e=0;e<c;e++){let s=0;for(let o=0;o<=e;o++){const r=h[o];r>0&&(s+=r*P[e-o]*Math.exp(-t.kLoss*(e-o)*n))}v[e]=B+s}const C=Math.max(1,Math.floor(c/(t.maxPoints||2e3))),A=[];for(let e=0;e<c;e+=C)A.push({time:e*n,bulkTemp:v[e],cumulativeEnergy:h.slice(0,e+1).reduce((s,o)=>s+o,0),power:h[e]/n,velocity:d[e]});return A}self.onmessage=t=>{const n=t.data;try{const l=x(n);postMessage(Array.isArray(l)?l:[])}catch(l){console.error("Worker simulation error:",l),postMessage([])}}})();
